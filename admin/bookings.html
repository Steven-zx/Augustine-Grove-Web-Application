<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link  href="../dist/output.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<title>Augustine Grove</title>
<style>
  .status-badge {
    padding: 0.25rem 0.5rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 600;
  }
  .status-pending {
    background-color: #FEF3C7;
    color: #92400E;
  }
  .status-approved {
    background-color: #D1FAE5;
    color: #065F46;
  }
  .status-rejected {
    background-color: #FEE2E2;
    color: #92400E;
  }
</style>
</head>
<body class="bg-[#FAF1E6]">

<!-- Nav Bar -->
<nav class="sticky top-0 z-50 flex items-center justify-between bg-[#5F8B4C] px-4 md:px-6 py-2 text-white backdrop-blur-sm">
  <a href="main.html" class="flex items-center gap-2">
    <img src="/pictures/logo 2.png" alt="Logo" class="h-8 w-auto md:h-12 lg:h-16">
    <div class="flex-row items-start">
    <span class="text-lg md:text-2xl font-bold">AUGUSTINE GROVE</span>
    <!-- Admin Badge beside logo or user -->
    <div class="gap-2 text-base font-bold">
      ADMIN
    </div>
    </div>
  </a>

  <!-- Hamburger Button -->
  <button id="menu-btn" class="block md:hidden focus:outline-none transition-transform duration-300" aria-label="Toggle Menu">
    <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
    </svg>
  </button>

  <!-- Desktop Menu -->
  <div id="menu-desktop" class="hidden md:flex flex-row items-center gap-6">
    <ul class="flex flex-row gap-8 text-md font-semibold font-poppins">
      <li><a href="announcements.html" class="hover:text-[#FFDDAB] transition-colors duration-200">Announcements</a></li>
      <li><a href="amenities.html" class="hover:text-[#FFDDAB] transition-colors duration-200">Amenities</a></li>
      <li><a href="gallery.html" class="hover:text-[#FFDDAB] transition-colors duration-200">Gallery</a></li>
      <li><a href="aboutpage.html" class="hover:text-[#FFDDAB] transition-colors duration-200">About</a></li>
    </ul>

    <!--profile button-->
    <div class="relative">
      <button id="profileBtn" class="focus:outline-none">
        <img src="/pictures/profile.png" alt="Profile" class="h-8 w-8 rounded-full">
      </button>

      <!-- Modal Dropdown -->
      <div id="profileModal" class="absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg hidden z-50">
        <button onclick="logout()" class="flex items-center gap-2 w-full text-left px-4 py-2 text-sm text-gray-700 font-bold hover:bg-gray-100">
          <img src="/pictures/logout_icon.png" alt="Logout" class="h-5 w-5">
          Log Out
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Slide-in Menu -->
  <div id="sidebar" class="fixed top-0 right-0 h-screen w-2/3 bg-white overflow-y-auto transform translate-x-full transition-transform duration-300 z-50 shadow-lg md:hidden pointer-events-none">
    <div class="flex items-center justify-between p-4 border-b border-gray-300">
      <h2 class="text-lg font-bold text-[#5F8B4C]">Menu</h2>
      <button id="close-btn" class="text-[#5F8B4C]">
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Profile Card -->
    <div class="bg-[#FAF1E6] rounded-xl shadow-md mx-6 my-6 p-4 flex items-center gap-4">
      <img src="/pictures/profilegreen_icon.png" alt="Profile Icon" class="h-10 w-10 rounded-full object-cover">
      <div class="text-left">
        <p class="font-semibold text-[#5F8B4C]">John Smith</p>
      </div>
    </div>

    <!-- Nav Links -->
    <ul class="flex flex-col gap-6 text-[#5F8B4C] font-semibold px-8">
      <li><a href="announcements.html" class="hover:text-[#FFDDAB] transition-colors duration-200">Announcements</a></li>
      <li><a href="amenities.html" class="hover:text-[#FFDDAB] transition-colors duration-200">Amenities</a></li>
      <li><a href="gallery.html" class="hover:text-[#FFDDAB] transition-colors duration-200">Gallery</a></li>
      <li><a href="aboutpage.html" class="hover:text-[#FFDDAB] transition-colors duration-200">About</a></li>
    </ul>

    <!-- Bottom Log Out Button -->
    <div class="w-full text-center mt-20 mb-6">
      <button class="bg-[#FAF1E6] text-[#5F8B4C] px-6 py-2 rounded-full hover:bg-green-700 font-semibold w-32">
        Log Out
      </button>
    </div>
  </div>
</nav>

<div class="flex justify-between items-center py-6 w-full">
  <h1 class="flex items-start md:text-2xl text-xl text-[#333333] font-bold sm:px-10 md:px-20">Booking Requests</h1>
  <!-- ðŸ”™ Back button -->
  <div class="px-6 py-2">
    <button onclick="history.back()" class="text-xl text-[#5F8B4C] hover:text-[#FFDDAB] transition-colors duration-200 font-bold">
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
</div>

<!-- Filters -->
<div class="flex flex-wrap gap-4 mb-10 px-4 sm:px-10 md:px-20">
  <select id="filter-status" class="bg-[#E6DCD0] border border-[#5F8B4C] rounded-xl px-4 py-2 text-sm font-medium focus:outline-none">
    <option value="all">All Statuses</option>
    <option value="Pending">Pending</option>
    <option value="Approved">Approved</option>
    <option value="Rejected">Rejected</option>
  </select>
  <select id="filter-amenity" class="bg-[#E6DCD0] border border-[#5F8B4C] rounded-xl px-4 py-2 text-sm font-medium focus:outline-none">
    <option value="all">All Amenities</option>
    <option value="Clubhouse">Clubhouse</option>
    <option value="Swimming Pool">Swimming Pool</option>
    <option value="Basketball Court">Basketball Court</option>
  </select>
  <select id="filter-sort" class="bg-[#E6DCD0] border border-[#5F8B4C] rounded-xl px-4 py-2 text-sm font-medium focus:outline-none">
    <option value="newest">Newest First</option>
    <option value="oldest">Oldest First</option>
  </select>
</div>

<!-- ðŸ“¦ Booking Container -->
<div id="booking-container" class="px-4 sm:px-10 md:px-20 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

<!-- Loading Indicator -->
<div id="loading" class="text-center py-8">
  <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-[#5F8B4C]"></div>
</div>

<!-- Empty State -->
<div id="empty-state" class="hidden text-center py-12">
  <img src="/pictures/no-bookings.svg" alt="No bookings" class="mx-auto h-32 mb-4">
  <h3 class="text-lg font-medium text-gray-700">No booking requests found</h3>
  <p class="text-gray-500 mt-2">All booking requests are processed.</p>
</div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  (function() {
    window.supabaseUrl = 'https://bynplwqqzlzfbdrbvuzk.supabase.co';
    window.supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ5bnBsd3Fxemx6ZmJkcmJ2dXprIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcyNDQ4NDIsImV4cCI6MjA2MjgyMDg0Mn0.w69ANA33wQnVONct7WX-lDrWqFZNWhuV96iHf5AKrXM';
    window.supabase = supabase.createClient(window.supabaseUrl, window.supabaseKey);
  })();

  const bookingContainer = document.getElementById('booking-container');
  const loadingIndicator = document.getElementById('loading');
  const emptyState = document.getElementById('empty-state');
  
  let allBookings = [];
  let filteredBookings = [];

  async function fetchBookings() {
    try {
      loadingIndicator.classList.remove('hidden');
      bookingContainer.innerHTML = '';
      emptyState.classList.add('hidden');

      const { data, error } = await supabase
        .from('bookings')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) throw error;

      if (!data || data.length === 0) {
        showEmptyState();
        return;
      }

      allBookings = data.map(booking => ({
        ...booking,
        formattedDate: new Date(booking.booking_date).toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        }),
        formattedTime: `${booking.start_time} - ${booking.end_time}`
      }));

      filteredBookings = [...allBookings];
      renderBookings(filteredBookings);
    } catch (error) {
      console.error('Error fetching bookings:', error);
      bookingContainer.innerHTML = `
        <div class="col-span-full bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
          Failed to load bookings. Please try again later.
        </div>
      `;
    } finally {
      loadingIndicator.classList.add('hidden');
    }
  }

  function renderBookings(bookings) {
    if (bookings.length === 0) {
      showEmptyState();
      return;
    }

    bookingContainer.innerHTML = bookings.map(booking => `
      <div class="bg-[#E6DCD0] rounded-xl shadow-md p-6 relative transition hover:shadow-lg">
        <!-- Status Badge -->
        <div class="status-badge status-${booking.status.toLowerCase()} mb-4">
          ${booking.status}
        </div>

        <!-- Booking Details -->
        <h2 class="text-lg font-bold text-[#333] mb-2">${booking.amenity_type || 'Amenity'}</h2>

        <div class="text-sm text-gray-700 space-y-1">
          <p><strong>First Name:</strong> ${booking.first_name || '-'}</p>
          <p><strong>Last Name:</strong> ${booking.last_name || '-'}</p>
          <p><strong>Contact Number:</strong> ${booking.contact_number || '-'}</p>
          <p><strong>Email:</strong> ${booking.email || '-'}</p>
          <p><strong>Date:</strong> ${booking.formattedDate || '-'}</p>
          <p><strong>Time:</strong> ${booking.formattedTime || '-'}</p>
          <p><strong>Purpose:</strong> ${booking.purpose || '-'}</p>
          <p><strong>Attendees:</strong> ${booking.attendees || '0'}</p>
          <p><strong>Resident/Guest:</strong> ${booking.user_type || '-'}</p>
          <p><strong>Notes:</strong> ${booking.notes || 'None'}</p>
        </div>

        <!-- Action Buttons -->
        <div class="mt-6 flex justify-end gap-3">
          <button onclick="updateBookingStatus(${booking.booking_id}, 'Approved')" 
            class="border px-4 py-2 rounded-xl text-sm shadow-md bg-[#FAF1E6] hover:bg-green-100 ${booking.status !== 'Pending' ? 'hidden' : ''}">
            Approve
          </button>
          <button onclick="updateBookingStatus(${booking.booking_id}, 'Rejected')" 
            class="border px-4 py-2 rounded-xl text-sm shadow-md bg-[#FAF1E6] hover:bg-red-100 ${booking.status !== 'Pending' ? 'hidden' : ''}">
            Reject
          </button>
        </div>
      </div>
    `).join('');
  }

  async function updateBookingStatus(bookingId, newStatus) {
    try {
      const { error } = await supabase
        .from('bookings')
        .update({ status: newStatus })
        .eq('booking_id', bookingId);

      if (error) throw error;

      // Refresh the bookings
      await fetchBookings();
    } catch (error) {
      console.error('Error updating booking status:', error);
      alert('Failed to update booking status. Please try again.');
    }
  }

  function showEmptyState() {
    bookingContainer.innerHTML = '';
    emptyState.classList.remove('hidden');
  }

  function applyFilters() {
    const status = document.getElementById('filter-status').value;
    const amenity = document.getElementById('filter-amenity').value;
    const sort = document.getElementById('filter-sort').value;

    let filtered = [...allBookings];

    // Filter by status
    if (status !== 'all') {
      filtered = filtered.filter(booking => booking.status === status);
    }

    // Filter by amenity
    if (amenity !== 'all') {
      filtered = filtered.filter(booking => booking.amenity_type === amenity);
    }

    // Sort
    if (sort === 'newest') {
      filtered.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
    } else {
      filtered.sort((a, b) => new Date(a.created_at) - new Date(b.created_at));
    }

    filteredBookings = filtered;
    renderBookings(filteredBookings);
  }

  // Mobile menu functionality
  document.getElementById('menu-btn')?.addEventListener('click', function() {
    document.getElementById('sidebar').classList.remove('translate-x-full', 'pointer-events-none');
    document.getElementById('sidebar').classList.add('translate-x-0', 'pointer-events-auto');
  });

  document.getElementById('close-btn')?.addEventListener('click', function() {
    document.getElementById('sidebar').classList.add('translate-x-full', 'pointer-events-none');
    document.getElementById('sidebar').classList.remove('translate-x-0', 'pointer-events-auto');
  });

  // Profile dropdown functionality
  document.getElementById('profileBtn')?.addEventListener('click', function() {
    document.getElementById('profileModal').classList.toggle('hidden');
  });

  // Close dropdown when clicking outside
  window.addEventListener('click', function(event) {
    if (!event.target.matches('#profileBtn')) {
      const dropdown = document.getElementById('profileModal');
      if (!dropdown.classList.contains('hidden')) {
        dropdown.classList.add('hidden');
      }
    }
  });

  function logout() {
    // Implement logout functionality here
    window.location.href = 'login.html';
  }

  document.addEventListener('DOMContentLoaded', async () => {
    await fetchBookings();
    
    // Set up filter event listeners
    document.getElementById('filter-status').addEventListener('change', applyFilters);
    document.getElementById('filter-amenity').addEventListener('change', applyFilters);
    document.getElementById('filter-sort').addEventListener('change', applyFilters);
  });
</script>
</body>
</html>